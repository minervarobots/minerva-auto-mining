webswingRequirejs.define(["jquery","text!templates/base.css","webswing-util","webswing-polyfill","webswing-base","webswing-socket","webswing-files","webswing-dialog","webswing-selector","webswing-login","webswing-canvas","webswing-identity","webswing-jslink","webswing-clipboard","webswing-playback","webswing-input","webswing-touch","webswing-inject"],function f($,css,util,polyfill,Base,Socket,Files,Dialog,Selector,Login,Canvas,Identity,JsLink,Clipboard,Playback,Input,Touch,Injector){function scanForInstances(e){e=e!=null?e:global;var t={},n=$("[data-webswing-instance]");n.each(function(e,n){var r=$(n).data("webswingInstance"),i=$(n).data("webswingActive");if(!i){var s=bootstrap($(n));$(n).attr("data-webswing-active","true"),r!=null&&(t[r]=s)}});for(var r in t)e[r]=t[r]}function bootstrap(e,t){var n=new Injector;n.module("webswing",new WebswingInstance(e)),n.module("dialog",new Dialog),n.module("canvas",new Canvas),n.module("base",new Base),n.module("input",new Input),n.module("touch",new Touch),n.module("socket",new Socket),n.module("files",new Files),n.module("selector",new Selector),n.module("login",new Login),n.module("identity",new Identity),n.module("jslink",new JsLink),n.module("clipboard",new Clipboard),n.module("playback",new Playback);var r={start:"webswing.start",disconnect:"webswing.disconnect",configure:"webswing.configure",kill:"base.kill",setControl:"webswing.setControl"};return n.module("external",{provides:r,injects:r}),t!=null&&t(n),n.injectAndVerify(),r}function WebswingInstance(rootElement){function defaultCtxConfig(){return{rootElement:setupRootElement(rootElement),autoStart:!1,applicationName:null,args:null,anonym:!1,connectionUrl:location.origin+location.pathname,mirror:!1,recordingPlayback:!1,typedArraysSupported:typedArraysSupported,binarySocket:!0,recording:!1,debugPort:null,javaCallTimeout:3e3,documentBase:document.location.origin+document.location.pathname,ieVersion:util.detectIE(),clientId:null,viewId:null,appName:null,hasControl:!1,mirrorMode:!1,canPaint:!1,applet:!1,virtualKB:!1}}function setupRootElement(e){return e.addClass("webswing-root")}function start(){api.login(function(){api.showDialog(api.initializingDialog),api.connect()})}function newSession(){api.disconnect(),api.disposeIdentity(),api.start()}function reTrySession(){api.disconnect(),api.start()}function disconnect(){api.disposeFileDialog(),api.disposeBase(),api.disposeCanvas(),api.disposeSocket(),api.disposeCopyBar()}function configure(e,t){var n=api.cfg;e=e!=null?e:readOptions(n.rootElement),e!=null&&(n.autoStart=e.autoStart!=null?JSON.parse(e.autoStart):n.autoStart,n.applicationName=e.applicationName!=null?e.applicationName:n.applicationName,n.args=e.args!=null?e.args:n.args,n.anonym=e.anonym!=null?JSON.parse(e.anonym):n.anonym,n.binarySocket=e.binarySocket!=null?JSON.parse(e.binarySocket):n.binarySocket,n.recording=e.recording!=null?JSON.parse(e.recording):n.recording,n.clientId=e.clientId!=null?e.clientId:n.clientId,n.mirror=e.mirrorMode!=null?JSON.parse(e.mirrorMode):n.mirror,n.connectionUrl=e.connectionUrl!=null?e.connectionUrl:n.connectionUrl,n.debugPort=e.debugPort!=null?e.debugPort:n.debugPort,n.javaCallTimeout=e.javaCallTimeout!=null?parseInt(e.javaCallTimeout,10):n.javaCallTimeout,n.connectionUrl.substr(n.connectionUrl.length-1)!=="/"&&(n.connectionUrl=n.connectionUrl+"/"),e.recordingPlayback!=null&&(n.recordingPlayback=n.applicationName=e.recordingPlayback,api.showPlaybackControls())),t=t!=null?t:readAppletParams(n.rootElement);if(t!=null){n.params=[];for(var r in t)typeof t[r]=="string"&&n.params.push({name:r,value:t[r]})}}function setControl(e){api.cfg.hasControl=e?!0:!1}function readOptions(element){var options=element.data("webswingOptions");if(typeof options!="object")try{options=eval("(function(){return "+options+";})()")}catch(e){throw Error("Configuration of webswing instance is not a valid json object. "+options)}return options}function readAppletParams(e){var t={},n=$(e).find("webswing-param");for(var r=0;r<n.length;r++){var i=n[r].getAttribute("name"),s=n[r].getAttribute("value");i!=null&&(t[i]=s)}return t}var module=this,api;module.injects=api={cfg:"webswing.config",start:"webswing.start",disconnect:"webswing.disconnect",login:"login.login",connect:"socket.connect",showDialog:"dialog.show",readyDialog:"dialog.content.readyDialog",initializingDialog:"dialog.content.initializingDialog",disposeIdentity:"identity.dispose",disposeBase:"base.dispose",disposeCanvas:"canvas.dispose",disposeSocket:"socket.dispose",disposeFileDialog:"files.close",disposeCopyBar:"clipboard.dispose",showPlaybackControls:"playback.showControls"},module.provides={config:defaultCtxConfig(),start:start,newSession:newSession,reTrySession:reTrySession,disconnect:disconnect,setControl:setControl,configure:configure},module.ready=function(){configure(),api.cfg.autoStart?api.start():api.showDialog(api.readyDialog)}}var style=$("<style></style>",{type:"text/css"});style.text(css),$("head").prepend(style);var globalName=$("[data-webswing-global-var]"),global={},typedArraysSupported=polyfill();if(globalName!=null&&globalName.length!==0){var name=globalName.data("webswingGlobalVar");global=window[name]={scan:scanForInstances,bootstrap:bootstrap},scanForInstances(window[name])}else scanForInstances(window)});