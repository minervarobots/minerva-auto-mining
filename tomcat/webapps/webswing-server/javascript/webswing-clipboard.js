webswingRequirejs.define(["jquery","text!templates/clipboard.html","text!templates/clipboard.css","webswing-util"],function(t,n,r,i){var s=t("<style></style>",{type:"text/css"});return s.text(r),t("head").prepend(s),function(){function u(e){a(e,!0)}function a(e,t){if(o==null||o.minimized===!0)s.send({copy:{type:t===!0?"cut":"copy"}});else{var n=o.wsEventData;if(s.cfg.ieVersion){var r=o.find('div[data-id="ie-clipboard"]'),i=window.clipboardData;n.html!=null?(r.html(n.html),f(),setTimeout(function(){v()},0)):(e.preventDefault(),i.setData("Text",n.text),v())}else e=e.originalEvent||e,e.preventDefault(),n.text!=null&&e.clipboardData.setData("text/plain",n.text),n.html!=null&&e.clipboardData.setData("text/html",n.html),v()}}function f(){ieClipboardDiv.focus();var e=document.createRange();e.selectNodeContents(ieClipboardDiv.get(0));var t=window.getSelection();t.removeAllRanges(),t.addRange(e)}function l(e){if(s.cfg.hasControl)if(m()){var t="",n="";if(s.cfg.ieVersion)t=window.clipboardData.getData("Text"),n=t;else{var r=e.clipboardData||e.originalEvent.clipboardData;t=r.getData("text/plain"),n=r.getData("text/html");if(r.items!=null)for(var i=0;i<r.items.length;i++)if(r.items[i].type.indexOf("image")===0){var o=r.items[i],u=new FileReader;u.onload=function(e){c(t,n,e.target.result)},u.readAsDataURL(o.getAsFile());return}}c(t,n)}else c()}function c(e,t,n){var r={};e!=null&&(r.text=e),t!=null&&(r.html=t),n!=null&&(r.img=n),s.send({paste:r})}function h(e){var r=!1;o!=null&&v();if(e.html==null&&e.text==null&&e.img==null&&(e.files==null||e.files.length===0)){if(!e.other)return;r=!0}s.cfg.rootElement.append(n),o=s.cfg.rootElement.find('div[data-id="copyBar"]'),o.on("click",function(e){clearTimeout(w),s.getInput().focus()}),o.wsEventData=e,o.minimized=!1;var u=o.find('button[data-id="closeBtn"]');u.click(function(){v()}),o.show("fast");if(e.text==null||e.text.length===0)o.find("#text").remove(),o.find("#textTab").remove();else{var a=o.find('textarea[data-id="textarea"]');a.val(e.text),o.find('span[data-id="plaintext"]').removeClass("webswing-copy-content-inactive").addClass("webswing-copy-content-active")}if(e.html==null||e.html.length===0)o.find("#html").remove(),o.find("#htmlTab").remove();else{var f=o.find('textarea[data-id="htmlarea"]');f.val(e.html),o.find('span[data-id="html"]').removeClass("webswing-copy-content-inactive").addClass("webswing-copy-content-active")}e.img==null?(o.find("#image").remove(),o.find("#imageTab").remove()):(o.find("#image>div").append('<img src="'+i.getImageString(e.img)+'" id="wsCopyImage" class="img-thumbnail">'),o.find('span[data-id="image"]').removeClass("webswing-copy-content-inactive").addClass("webswing-copy-content-active"));if(e.files==null||e.files.length===0)o.find("#files").remove(),o.find("#filesTab").remove();else{var l=o.find("#wsFileList");for(var c=0;c<e.files.length;c++){var h=e.files[c],m=t("<a>");h.indexOf("#")===0?(m=t("<span>"),m.html(e.files[c].substring(1))):(m.html(e.files[c]),m.on("click",function(e){s.send({copy:{type:"getFileFromClipboard",file:t(e.currentTarget).html()}})})),l.append(m),l.append("<br/>")}o.find('span[data-id="files"]').removeClass("webswing-copy-content-inactive").addClass("webswing-copy-content-active")}e.other?o.find('span[data-id="other"]').removeClass("webswing-copy-content-inactive").addClass("webswing-copy-content-active"):(o.find("#other").remove(),o.find("#otherTab").remove());var g=o.find(".nav-tabs>li");g.first().addClass("active"),o.find(".tab-pane").first().addClass("active"),g.on("click",function(e){g.removeClass("active"),o.find(".tab-pane").removeClass("active"),t(e.currentTarget).addClass("active"),o.find("#"+t(e.currentTarget).data("tab")).addClass("active")});var y=o.find('div[data-id="minimizedInfoBar"]');y.on("click",function(e){d()});var b=o.find(".webswing-minimize-symbol");b.on("click",function(e){p()});if(r)o.find('div[data-id="contentBar"]').hide(),o.find('div[data-id="minimizedInfoBar"]').show(),o.minimized=!0;else var w=setTimeout(function(){p()},2e3)}function p(){o!=null&&(o.find('div[data-id="contentBar"]').slideUp("fast"),o.find('div[data-id="minimizedInfoBar"]').fadeIn("fast"),o.minimized=!0)}function d(){o!=null&&(o.find('div[data-id="contentBar"]').slideDown("fast"),o.find('div[data-id="minimizedInfoBar"]').fadeOut("fast"),o.minimized=!1)}function v(){o!=null&&(o.hide("fast"),o.remove(),o=null)}function m(){if(o==null)return!0}var r=this,s;r.injects=s={cfg:"webswing.config",send:"socket.send",getInput:"canvas.getInput"},r.provides={cut:u,copy:a,paste:l,displayCopyBar:h,dispose:v};var o}});