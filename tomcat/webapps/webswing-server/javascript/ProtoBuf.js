/*
 ProtoBuf.js (c) 2013 Daniel Wirtz <dcode@dcode.io>
 Released under the Apache License, Version 2.0
 see: https://github.com/dcodeIO/ProtoBuf.js for details
*/

(function(e){function t(e){var t={VERSION:"3.7.0",WIRE_TYPES:{}};return t.WIRE_TYPES.VARINT=0,t.WIRE_TYPES.BITS64=1,t.WIRE_TYPES.LDELIM=2,t.WIRE_TYPES.STARTGROUP=3,t.WIRE_TYPES.ENDGROUP=4,t.WIRE_TYPES.BITS32=5,t.PACKABLE_WIRE_TYPES=[t.WIRE_TYPES.VARINT,t.WIRE_TYPES.BITS64,t.WIRE_TYPES.BITS32],t.TYPES={int32:{name:"int32",wireType:t.WIRE_TYPES.VARINT},uint32:{name:"uint32",wireType:t.WIRE_TYPES.VARINT},sint32:{name:"sint32",wireType:t.WIRE_TYPES.VARINT},int64:{name:"int64",wireType:t.WIRE_TYPES.VARINT},uint64:{name:"uint64",wireType:t.WIRE_TYPES.VARINT},sint64:{name:"sint64",wireType:t.WIRE_TYPES.VARINT},bool:{name:"bool",wireType:t.WIRE_TYPES.VARINT},"double":{name:"double",wireType:t.WIRE_TYPES.BITS64},string:{name:"string",wireType:t.WIRE_TYPES.LDELIM},bytes:{name:"bytes",wireType:t.WIRE_TYPES.LDELIM},fixed32:{name:"fixed32",wireType:t.WIRE_TYPES.BITS32},sfixed32:{name:"sfixed32",wireType:t.WIRE_TYPES.BITS32},fixed64:{name:"fixed64",wireType:t.WIRE_TYPES.BITS64},sfixed64:{name:"sfixed64",wireType:t.WIRE_TYPES.BITS64},"float":{name:"float",wireType:t.WIRE_TYPES.BITS32},"enum":{name:"enum",wireType:t.WIRE_TYPES.VARINT},message:{name:"message",wireType:t.WIRE_TYPES.LDELIM},group:{name:"group",wireType:t.WIRE_TYPES.STARTGROUP}},t.ID_MIN=1,t.ID_MAX=536870911,t.ByteBuffer=e,t.Long=e.Long||null,t.convertFieldsToCamelCase=!1,t.populateAccessors=!0,t.Util=function(){Object.create||(Object.create=function(e){function t(){}if(1<arguments.length)throw Error("Object.create polyfill only accepts the first parameter.");return t.prototype=e,new t});var e={IS_NODE:!1};try{e.IS_NODE="function"==typeof require&&"function"==typeof require("fs").readFileSync&&"function"==typeof require("path").resolve}catch(t){}return e.XHR=function(){for(var e=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],t=null,n=0;n<e.length;n++){try{t=e[n]()}catch(r){continue}break}if(!t)throw Error("XMLHttpRequest is not supported");return t},e.fetch=function(t,n){n&&"function"!=typeof n&&(n=null);if(e.IS_NODE)if(n)require("fs").readFile(t,function(e,t){e?n(null):n(""+t)});else try{return require("fs").readFileSync(t)}catch(r){return null}else{var i=e.XHR();i.open("GET",t,n?!0:!1),i.setRequestHeader("Accept","text/plain"),"function"==typeof i.overrideMimeType&&i.overrideMimeType("text/plain");if(!n)return i.send(null),200==i.status||0==i.status&&"string"==typeof i.responseText?i.responseText:null;i.onreadystatechange=function(){4==i.readyState&&(200==i.status||0==i.status&&"string"==typeof i.responseText?n(i.responseText):n(null))},4!=i.readyState&&i.send(null)}},e.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},e}(),t.Lang={OPEN:"{",CLOSE:"}",OPTOPEN:"[",OPTCLOSE:"]",OPTEND:",",EQUAL:"=",END:";",STRINGOPEN:'"',STRINGCLOSE:'"',STRINGOPEN_SQ:"'",STRINGCLOSE_SQ:"'",COPTOPEN:"(",COPTCLOSE:")",DELIM:/[\s\{\}=;\[\],'"\(\)]/g,RULE:/^(?:required|optional|repeated)$/,TYPE:/^(?:double|float|int32|uint32|sint32|int64|uint64|sint64|fixed32|sfixed32|fixed64|sfixed64|bool|string|bytes)$/,NAME:/^[a-zA-Z_][a-zA-Z_0-9]*$/,TYPEDEF:/^[a-zA-Z][a-zA-Z_0-9]*$/,TYPEREF:/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)+$/,FQTYPEREF:/^(?:\.[a-zA-Z][a-zA-Z_0-9]*)+$/,NUMBER:/^-?(?:[1-9][0-9]*|0|0x[0-9a-fA-F]+|0[0-7]+|([0-9]*\.[0-9]+([Ee][+-]?[0-9]+)?))$/,NUMBER_DEC:/^(?:[1-9][0-9]*|0)$/,NUMBER_HEX:/^0x[0-9a-fA-F]+$/,NUMBER_OCT:/^0[0-7]+$/,NUMBER_FLT:/^[0-9]*\.[0-9]+([Ee][+-]?[0-9]+)?$/,ID:/^(?:[1-9][0-9]*|0|0x[0-9a-fA-F]+|0[0-7]+)$/,NEGID:/^\-?(?:[1-9][0-9]*|0|0x[0-9a-fA-F]+|0[0-7]+)$/,WHITESPACE:/\s/,STRING:/['"]([^'"\\]*(\\.[^"\\]*)*)['"]/g,BOOL:/^(?:true|false)$/i},t.DotProto=function(e,t){var n={},r=function(e){this.source=""+e,this.index=0,this.line=1,this.stack=[],this.readingString=!1,this.stringEndsWith=t.STRINGCLOSE},i=r.prototype;i._readString=function(){t.STRING.lastIndex=this.index-1;var e;if(null!==(e=t.STRING.exec(this.source)))return e=e[1],this.index=t.STRING.lastIndex,this.stack.push(this.stringEndsWith),e;throw Error("Unterminated string at line "+this.line+", index "+this.index)},i.next=function(){if(0<this.stack.length)return this.stack.shift();if(this.index>=this.source.length)return null;if(this.readingString)return this.readingString=!1,this._readString();var e,n;do{for(e=!1;t.WHITESPACE.test(n=this.source.charAt(this.index));)if(this.index++,"\n"===n&&this.line++,this.index===this.source.length)return null;if("/"===this.source.charAt(this.index))if("/"===this.source.charAt(++this.index)){for(;"\n"!==this.source.charAt(this.index);)if(this.index++,this.index==this.source.length)return null;this.index++,this.line++,e=!0}else{if("*"!==this.source.charAt(this.index))throw Error("Unterminated comment at line "+this.line+": /"+this.source.charAt(this.index));for(n="";"*/"!==n+(n=this.source.charAt(this.index));)if(this.index++,"\n"===n&&this.line++,this.index===this.source.length)return null;this.index++,e=!0}}while(e);if(this.index===this.source.length)return null;e=this.index,t.DELIM.lastIndex=0;if(t.DELIM.test(this.source.charAt(e)))++e;else for(++e;e<this.source.length&&!t.DELIM.test(this.source.charAt(e));)e++;return e=this.source.substring(this.index,this.index=e),e===t.STRINGOPEN?(this.readingString=!0,this.stringEndsWith=t.STRINGCLOSE):e===t.STRINGOPEN_SQ&&(this.readingString=!0,this.stringEndsWith=t.STRINGCLOSE_SQ),e},i.peek=function(){if(0===this.stack.length){var e=this.next();if(null===e)return null;this.stack.push(e)}return this.stack[0]},i.toString=function(){return"Tokenizer("+this.index+"/"+this.source.length+" at line "+this.line+")"},n.Tokenizer=r;var i=function(e){this.tn=new r(e)},s=i.prototype;return s.parse=function(){for(var e={name:"[ROOT]","package":null,messages:[],enums:[],imports:[],options:{},services:[]},t,n=!0;t=this.tn.next();)switch(t){case"package":if(!n||null!==e["package"])throw Error("Unexpected package at line "+this.tn.line);e["package"]=this._parsePackage(t);break;case"import":if(!n)throw Error("Unexpected import at line "+this.tn.line);e.imports.push(this._parseImport(t));break;case"message":this._parseMessage(e,null,t),n=!1;break;case"enum":this._parseEnum(e,t),n=!1;break;case"option":if(!n)throw Error("Unexpected option at line "+this.tn.line);this._parseOption(e,t);break;case"service":this._parseService(e,t);break;case"extend":this._parseExtend(e,t);break;case"syntax":this._parseIgnoredStatement(e,t);break;default:throw Error("Unexpected token at line "+this.tn.line+": "+t)}return delete e.name,e},s._parseNumber=function(e){var n=1;"-"==e.charAt(0)&&(n=-1,e=e.substring(1));if(t.NUMBER_DEC.test(e))return n*parseInt(e,10);if(t.NUMBER_HEX.test(e))return n*parseInt(e.substring(2),16);if(t.NUMBER_OCT.test(e))return n*parseInt(e.substring(1),8);if(t.NUMBER_FLT.test(e))return n*parseFloat(e);throw Error("Illegal number at line "+this.tn.line+": "+(0>n?"-":"")+e)},s._parseString=function(){var e="",n;do{this.tn.next(),e+=this.tn.next(),n=this.tn.next();if(n!==this.tn.stringEndsWith)throw Error("Illegal end of string at line "+this.tn.line+": "+n);n=this.tn.peek()}while(n===t.STRINGOPEN||n===t.STRINGOPEN_SQ);return e},s._parseId=function(e,n){var r=-1,i=1;"-"==e.charAt(0)&&(i=-1,e=e.substring(1));if(t.NUMBER_DEC.test(e))r=parseInt(e);else if(t.NUMBER_HEX.test(e))r=parseInt(e.substring(2),16);else{if(!t.NUMBER_OCT.test(e))throw Error("Illegal id at line "+this.tn.line+": "+(0>i?"-":"")+e);r=parseInt(e.substring(1),8)}r=i*r|0;if(!n&&0>r)throw Error("Illegal id at line "+this.tn.line+": "+(0>i?"-":"")+e);return r},s._parsePackage=function(e){e=this.tn.next();if(!t.TYPEREF.test(e))throw Error("Illegal package name at line "+this.tn.line+": "+e);var n=e;e=this.tn.next();if(e!=t.END)throw Error("Illegal end of package at line "+this.tn.line+": "+e);return n},s._parseImport=function(e){e=this.tn.peek(),"public"===e&&(this.tn.next(),e=this.tn.peek());if(e!==t.STRINGOPEN&&e!==t.STRINGOPEN_SQ)throw Error("Illegal start of import at line "+this.tn.line+": "+e);var n=this._parseString();e=this.tn.next();if(e!==t.END)throw Error("Illegal end of import at line "+this.tn.line+": "+e);return n},s._parseOption=function(e,n){n=this.tn.next();var r=!1;n==t.COPTOPEN&&(r=!0,n=this.tn.next());if(!t.TYPEREF.test(n)&&!/google\.protobuf\./.test(n))throw Error("Illegal option name in message "+e.name+" at line "+this.tn.line+": "+n);var i=n;n=this.tn.next();if(r){if(n!==t.COPTCLOSE)throw Error("Illegal end in message "+e.name+", option "+i+" at line "+this.tn.line+": "+n);i="("+i+")",n=this.tn.next(),t.FQTYPEREF.test(n)&&(i+=n,n=this.tn.next())}if(n!==t.EQUAL)throw Error("Illegal operator in message "+e.name+", option "+i+" at line "+this.tn.line+": "+n);n=this.tn.peek();if(n===t.STRINGOPEN||n===t.STRINGOPEN_SQ)r=this._parseString();else if(this.tn.next(),t.NUMBER.test(n))r=this._parseNumber(n,!0);else if(t.BOOL.test(n))r="true"===n;else{if(!t.TYPEREF.test(n))throw Error("Illegal option value in message "+e.name+", option "+i+" at line "+this.tn.line+": "+n);r=n}n=this.tn.next();if(n!==t.END)throw Error("Illegal end of option in message "+e.name+", option "+i+" at line "+this.tn.line+": "+n);e.options[i]=r},s._parseIgnoredStatement=function(e,n){var r;do{r=this.tn.next();if(null===r)throw Error("Unexpected EOF in "+e.name+", "+n+" at line "+this.tn.line);if(r===t.END)break}while(1)},s._parseService=function(e,n){n=this.tn.next();if(!t.NAME.test(n))throw Error("Illegal service name at line "+this.tn.line+": "+n);var r=n,i={name:r,rpc:{},options:{}};n=this.tn.next();if(n!==t.OPEN)throw Error("Illegal start of service "+r+" at line "+this.tn.line+": "+n);do if(n=this.tn.next(),"option"===n)this._parseOption(i,n);else if("rpc"===n)this._parseServiceRPC(i,n);else if(n!==t.CLOSE)throw Error("Illegal type of service "+r+" at line "+this.tn.line+": "+n);while(n!==t.CLOSE);e.services.push(i)},s._parseServiceRPC=function(e,n){var r=n;n=this.tn.next();if(!t.NAME.test(n))throw Error("Illegal method name in service "+e.name+" at line "+this.tn.line+": "+n);var i=n,s={request:null,response:null,options:{}};n=this.tn.next();if(n!==t.COPTOPEN)throw Error("Illegal start of request type in service "+e.name+"#"+i+" at line "+this.tn.line+": "+n);n=this.tn.next();if(!t.TYPEREF.test(n))throw Error("Illegal request type in service "+e.name+"#"+i+" at line "+this.tn.line+": "+n);s.request=n,n=this.tn.next();if(n!=t.COPTCLOSE)throw Error("Illegal end of request type in service "+e.name+"#"+i+" at line "+this.tn.line+": "+n);n=this.tn.next();if("returns"!==n.toLowerCase())throw Error("Illegal delimiter in service "+e.name+"#"+i+" at line "+this.tn.line+": "+n);n=this.tn.next();if(n!=t.COPTOPEN)throw Error("Illegal start of response type in service "+e.name+"#"+i+" at line "+this.tn.line+": "+n);n=this.tn.next(),s.response=n,n=this.tn.next();if(n!==t.COPTCLOSE)throw Error("Illegal end of response type in service "+e.name+"#"+i+" at line "+this.tn.line+": "+n);n=this.tn.next();if(n===t.OPEN){do if(n=this.tn.next(),"option"===n)this._parseOption(s,n);else if(n!==t.CLOSE)throw Error("Illegal start of option inservice "+e.name+"#"+i+" at line "+this.tn.line+": "+n);while(n!==t.CLOSE);this.tn.peek()===t.END&&this.tn.next()}else if(n!==t.END)throw Error("Illegal delimiter in service "+e.name+"#"+i+" at line "+this.tn.line+": "+n);"undefined"==typeof e[r]&&(e[r]={}),e[r][i]=s},s._parseMessage=function(e,n,r){var i={},s="group"===r;r=this.tn.next();if(!t.NAME.test(r))throw Error("Illegal "+(s?"group":"message")+" name"+(e?" in message "+e.name:"")+" at line "+this.tn.line+": "+r);i.name=r;if(s){r=this.tn.next();if(r!==t.EQUAL)throw Error("Illegal id assignment after group "+i.name+" at line "+this.tn.line+": "+r);r=this.tn.next();try{n.id=this._parseId(r)}catch(o){throw Error("Illegal field id value for group "+i.name+"#"+n.name+" at line "+this.tn.line+": "+r)}i.isGroup=!0}i.fields=[],i.enums=[],i.messages=[],i.options={},i.oneofs={},r=this.tn.next(),r===t.OPTOPEN&&n&&(this._parseFieldOptions(i,n,r),r=this.tn.next());if(r!==t.OPEN)throw Error("Illegal start of "+(s?"group":"message")+" "+i.name+" at line "+this.tn.line+": "+r);do{if(r=this.tn.next(),r===t.CLOSE){r=this.tn.peek(),r===t.END&&this.tn.next();break}if(t.RULE.test(r))this._parseMessageField(i,r);else if("oneof"===r)this._parseMessageOneOf(i,r);else if("enum"===r)this._parseEnum(i,r);else if("message"===r)this._parseMessage(i,null,r);else if("option"===r)this._parseOption(i,r);else if("extensions"===r)i.extensions=this._parseExtensions(i,r);else{if("extend"!==r)throw Error("Illegal token in message "+i.name+" at line "+this.tn.line+": "+r);this._parseExtend(i,r)}}while(1);return e.messages.push(i),i},s._parseMessageField=function(e,n){var r={},i=null;r.rule=n,r.options={},n=this.tn.next();if("group"===n){i=this._parseMessage(e,r,n);if(!/^[A-Z]/.test(i.name))throw Error("Group names must start with a capital letter");r.type=i.name,r.name=i.name.toLowerCase(),n=this.tn.peek(),n===t.END&&this.tn.next()}else{if(!t.TYPE.test(n)&&!t.TYPEREF.test(n))throw Error("Illegal field type in message "+e.name+" at line "+this.tn.line+": "+n);r.type=n,n=this.tn.next();if(!t.NAME.test(n))throw Error("Illegal field name in message "+e.name+" at line "+this.tn.line+": "+n);r.name=n,n=this.tn.next();if(n!==t.EQUAL)throw Error("Illegal token in field "+e.name+"#"+r.name+" at line "+this.tn.line+": "+n);n=this.tn.next();try{r.id=this._parseId(n)}catch(s){throw Error("Illegal field id in message "+e.name+"#"+r.name+" at line "+this.tn.line+": "+n)}n=this.tn.next(),n===t.OPTOPEN&&(this._parseFieldOptions(e,r,n),n=this.tn.next());if(n!==t.END)throw Error("Illegal delimiter in message "+e.name+"#"+r.name+" at line "+this.tn.line+": "+n)}return e.fields.push(r),r},s._parseMessageOneOf=function(e,n){n=this.tn.next();if(!t.NAME.test(n))throw Error("Illegal oneof name in message "+e.name+" at line "+this.tn.line+": "+n);var r=n,i,s=[];n=this.tn.next();if(n!==t.OPEN)throw Error("Illegal start of oneof "+r+" at line "+this.tn.line+": "+n);for(;this.tn.peek()!==t.CLOSE;)i=this._parseMessageField(e,"optional"),i.oneof=r,s.push(i.id);this.tn.next(),e.oneofs[r]=s},s._parseFieldOptions=function(e,n,r){var i=!0;do{r=this.tn.next();if(r===t.OPTCLOSE)break;if(r===t.OPTEND){if(i)throw Error("Illegal start of options in message "+e.name+"#"+n.name+" at line "+this.tn.line+": "+r);r=this.tn.next()}this._parseFieldOption(e,n,r),i=!1}while(1)},s._parseFieldOption=function(e,n,r){var i=!1;r===t.COPTOPEN&&(r=this.tn.next(),i=!0);if(!t.TYPEREF.test(r))throw Error("Illegal field option in "+e.name+"#"+n.name+" at line "+this.tn.line+": "+r);var s=r;r=this.tn.next();if(i){if(r!==t.COPTCLOSE)throw Error("Illegal delimiter in "+e.name+"#"+n.name+" at line "+this.tn.line+": "+r);s="("+s+")",r=this.tn.next(),t.FQTYPEREF.test(r)&&(s+=r,r=this.tn.next())}if(r!==t.EQUAL)throw Error("Illegal token in "+e.name+"#"+n.name+" at line "+this.tn.line+": "+r);r=this.tn.peek();if(r===t.STRINGOPEN||r===t.STRINGOPEN_SQ)e=this._parseString();else if(t.NUMBER.test(r,!0))e=this._parseNumber(this.tn.next(),!0);else if(t.BOOL.test(r))e="true"===this.tn.next().toLowerCase();else{if(!t.TYPEREF.test(r))throw Error("Illegal value in message "+e.name+"#"+n.name+", option "+s+" at line "+this.tn.line+": "+r);e=this.tn.next()}n.options[s]=e},s._parseEnum=function(e,n){var r={};n=this.tn.next();if(!t.NAME.test(n))throw Error("Illegal enum name in message "+e.name+" at line "+this.tn.line+": "+n);r.name=n,n=this.tn.next();if(n!==t.OPEN)throw Error("Illegal start of enum "+r.name+" at line "+this.tn.line+": "+n);r.values=[],r.options={};do{n=this.tn.next();if(n===t.CLOSE){n=this.tn.peek(),n===t.END&&this.tn.next();break}if("option"==n)this._parseOption(r,n);else{if(!t.NAME.test(n))throw Error("Illegal name in enum "+r.name+" at line "+this.tn.line+": "+n);this._parseEnumValue(r,n)}}while(1);e.enums.push(r)},s._parseEnumValue=function(e,n){var r={};r.name=n,n=this.tn.next();if(n!==t.EQUAL)throw Error("Illegal token in enum "+e.name+" at line "+this.tn.line+": "+n);n=this.tn.next();try{r.id=this._parseId(n,!0)}catch(i){throw Error("Illegal id in enum "+e.name+" at line "+this.tn.line+": "+n)}e.values.push(r),n=this.tn.next(),n===t.OPTOPEN&&(this._parseFieldOptions(e,{options:{}},n),n=this.tn.next());if(n!==t.END)throw Error("Illegal delimiter in enum "+e.name+" at line "+this.tn.line+": "+n)},s._parseExtensions=function(n,r){var i=[];r=this.tn.next(),"min"===r?i.push(e.ID_MIN):"max"===r?i.push(e.ID_MAX):i.push(this._parseNumber(r)),r=this.tn.next();if("to"!==r)throw Error("Illegal extensions delimiter in message "+n.name+" at line "+this.tn.line+": "+r);r=this.tn.next(),"min"===r?i.push(e.ID_MIN):"max"===r?i.push(e.ID_MAX):i.push(this._parseNumber(r)),r=this.tn.next();if(r!==t.END)throw Error("Illegal extensions delimiter in message "+n.name+" at line "+this.tn.line+": "+r);return i},s._parseExtend=function(e,n){n=this.tn.next();if(!t.TYPEREF.test(n))throw Error("Illegal message name at line "+this.tn.line+": "+n);var r={};r.ref=n,r.fields=[],n=this.tn.next();if(n!==t.OPEN)throw Error("Illegal start of extend "+r.name+" at line "+this.tn.line+": "+n);do{if(n=this.tn.next(),n===t.CLOSE){n=this.tn.peek(),n==t.END&&this.tn.next();break}if(!t.RULE.test(n))throw Error("Illegal token in extend "+r.name+" at line "+this.tn.line+": "+n);this._parseMessageField(r,n)}while(1);return e.messages.push(r),r},s.toString=function(){return"Parser"},n.Parser=i,n}(t,t.Lang),t.Reflect=function(t){function n(e,r){var i=r.readVarint32(),s=i&7,i=i>>3;switch(s){case t.WIRE_TYPES.VARINT:do i=r.readUint8();while(128===(i&128));break;case t.WIRE_TYPES.BITS64:r.offset+=8;break;case t.WIRE_TYPES.LDELIM:i=r.readVarint32(),r.offset+=i;break;case t.WIRE_TYPES.STARTGROUP:n(i,r);break;case t.WIRE_TYPES.ENDGROUP:if(i===e)return!1;throw Error("Illegal GROUPEND after unknown group: "+i+" ("+e+" expected)");case t.WIRE_TYPES.BITS32:r.offset+=4;break;default:throw Error("Illegal wire type in unknown group "+e+": "+s)}return!0}function r(e,n){if(e&&"number"==typeof e.low&&"number"==typeof e.high&&"boolean"==typeof e.unsigned&&e.low===e.low&&e.high===e.high)return new t.Long(e.low,e.high,"undefined"==typeof n?e.unsigned:n);if("string"==typeof e)return t.Long.fromString(e,n||!1,10);if("number"==typeof e)return t.Long.fromNumber(e,n||!1);throw Error("not convertible to Long")}var i={},s=function(e,t,n){this.builder=e,this.parent=t,this.name=n},o=s.prototype;o.fqn=function(){var e=this.name,t=this;do{t=t.parent;if(null==t)break;e=t.name+"."+e}while(1);return e},o.toString=function(e){return(e?this.className+" ":"")+this.fqn()},o.build=function(){throw Error(this.toString(!0)+" cannot be built directly")},i.T=s;var u=function(e,t,n,r){s.call(this,e,t,n),this.className="Namespace",this.children=[],this.options=r||{}},o=u.prototype=Object.create(s.prototype);o.getChildren=function(e){e=e||null;if(null==e)return this.children.slice();for(var t=[],n=0,r=this.children.length;n<r;++n)this.children[n]instanceof e&&t.push(this.children[n]);return t},o.addChild=function(e){var t;if(t=this.getChild(e.name))if(t instanceof a.Field&&t.name!==t.originalName&&null===this.getChild(t.originalName))t.name=t.originalName;else{if(!(e instanceof a.Field&&e.name!==e.originalName&&null===this.getChild(e.originalName)))throw Error("Duplicate name in namespace "+this.toString(!0)+": "+e.name);e.name=e.originalName}this.children.push(e)},o.getChild=function(e){for(var t="number"==typeof e?"id":"name",n=0,r=this.children.length;n<r;++n)if(this.children[n][t]===e)return this.children[n];return null},o.resolve=function(e,t){var n=e.split("."),r=this,s=0;if(""===n[s]){for(;null!==r.parent;)r=r.parent;s++}do{do{r=r.getChild(n[s]);if(!(r&&r instanceof i.T)||t&&r instanceof i.Message.Field){r=null;break}s++}while(s<n.length);if(null!=r)break;if(null!==this.parent)return this.parent.resolve(e,t)}while(null!=r);return r},o.build=function(){for(var e={},t=this.children,n=0,r=t.length,i;n<r;++n)i=t[n],i instanceof u&&(e[i.name]=i.build());return Object.defineProperty&&Object.defineProperty(e,"$options",{value:this.buildOpt()}),e},o.buildOpt=function(){for(var e={},t=Object.keys(this.options),n=0,r=t.length;n<r;++n)e[t[n]]=this.options[t[n]];return e},o.getOption=function(e){return"undefined"==typeof e?this.options:"undefined"!=typeof this.options[e]?this.options[e]:null},i.Namespace=u;var a=function(e,n,r,i,s){u.call(this,e,n,r,i),this.className="Message",this.extensions=[t.ID_MIN,t.ID_MAX],this.clazz=null,this.isGroup=!!s,this._fieldsByName=this._fieldsById=this._fields=null},f=a.prototype=Object.create(u.prototype);f.build=function(n){if(this.clazz&&!n)return this.clazz;n=function(t,n){function r(t,n){var i={},s;for(s in t)t.hasOwnProperty(s)&&(null===t[s]||"object"!=typeof t[s]?i[s]=t[s]:t[s]instanceof e?n&&(i[s]=t.toBuffer()):i[s]=r(t[s],n));return i}var i=n.getChildren(t.Reflect.Message.Field),s=n.getChildren(t.Reflect.Message.OneOf),o=function(n,r){t.Builder.Message.call(this);for(var o=0,u=s.length;o<u;++o)this[s[o].name]=null;o=0;for(u=i.length;o<u;++o){var a=i[o];this[a.name]=a.repeated?[]:null,a.required&&null!==a.defaultValue&&(this[a.name]=a.defaultValue)}if(0<arguments.length)if(1!==arguments.length||"object"!=typeof n||"function"==typeof n.encode||t.Util.isArray(n)||n instanceof e||n instanceof ArrayBuffer||t.Long&&n instanceof t.Long)for(o=0,u=arguments.length;o<u;++o)this.$set(i[o].name,arguments[o]);else for(a=Object.keys(n),o=0,u=a.length;o<u;++o)this.$set(a[o],n[a[o]])},u=o.prototype=Object.create(t.Builder.Message.prototype);u.add=function(e,r,i){var s=n._fieldsByName[e];if(!i){if(!s)throw Error(this+"#"+e+" is undefined");if(!(s instanceof t.Reflect.Message.Field))throw Error(this+"#"+e+" is not a field: "+s.toString(!0));if(!s.repeated)throw Error(this+"#"+e+" is not a repeated field")}null===this[s.name]&&(this[s.name]=[]),this[s.name].push(i?r:s.verifyValue(r,!0))},u.$add=u.add,u.set=function(e,r,i){if(e&&"object"==typeof e){for(var s in e)e.hasOwnProperty(s)&&this.$set(s,e[s],i);return this}s=n._fieldsByName[e];if(i)this[s.name]=r;else{if(!s)throw Error(this+"#"+e+" is not a field: undefined");if(!(s instanceof t.Reflect.Message.Field))throw Error(this+"#"+e+" is not a field: "+s.toString(!0));this[s.name]=r=s.verifyValue(r)}return s.oneof&&(null!==r?(null!==this[s.oneof.name]&&(this[this[s.oneof.name]]=null),this[s.oneof.name]=s.name):s.oneof.name===e&&(this[s.oneof.name]=null)),this},u.$set=u.set,u.get=function(e,r){if(r)return this[e];var i=n._fieldsByName[e];if(!(i&&i instanceof t.Reflect.Message.Field))throw Error(this+"#"+e+" is not a field: undefined");if(i instanceof t.Reflect.Message.Field)return this[i.name];throw Error(this+"#"+e+" is not a field: "+i.toString(!0))},u.$get=u.get;for(var a=0;a<i.length;a++){var f=i[a];f instanceof t.Reflect.Message.ExtensionField||n.builder.options.populateAccessors&&function(e){var t=e.originalName.replace(/(_[a-zA-Z])/g,function(e){return e.toUpperCase().replace("_","")}),t=t.substring(0,1).toUpperCase()+t.substring(1),r=e.originalName.replace(/([A-Z])/g,function(e){return"_"+e}),i=function(t,n){return this[e.name]=n?t:e.verifyValue(t),this},s=function(){return this[e.name]};null===n.getChild("set"+t)&&(u["set"+t]=i),null===n.getChild("set_"+r)&&(u["set_"+r]=i),null===n.getChild("get"+t)&&(u["get"+t]=s),null===n.getChild("get_"+r)&&(u["get_"+r]=s)}(f)}return u.encode=function(t,r){"boolean"==typeof t&&(r=t,t=void 0);var i=!1;t||(t=new e,i=!0);var s=t.littleEndian;try{return n.encode(this,t.LE(),r),(i?t.flip():t).LE(s)}catch(o){throw t.LE(s),o}},u.calculate=function(){return n.calculate(this)},u.encodeDelimited=function(t){var r=!1;t||(t=new e,r=!0);var i=(new e).LE();return n.encode(this,i).flip(),t.writeVarint32(i.remaining()),t.append(i),r?t.flip():t},u.encodeAB=function(){try{return this.encode().toArrayBuffer()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toArrayBuffer()),e}},u.toArrayBuffer=u.encodeAB,u.encodeNB=function(){try{return this.encode().toBuffer()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toBuffer()),e}},u.toBuffer=u.encodeNB,u.encode64=function(){try{return this.encode().toBase64()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toBase64()),e}},u.toBase64=u.encode64,u.encodeHex=function(){try{return this.encode().toHex()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toHex()),e}},u.toHex=u.encodeHex,u.toRaw=function(e){return r(this,!!e)},o.decode=function(t,r){"string"==typeof t&&(t=e.wrap(t,r?r:"base64")),t=t instanceof e?t:e.wrap(t);var i=t.littleEndian;try{var s=n.decode(t.LE());return t.LE(i),s}catch(o){throw t.LE(i),o}},o.decodeDelimited=function(t,r){"string"==typeof t&&(t=e.wrap(t,r?r:"base64")),t=t instanceof e?t:e.wrap(t);if(1>t.remaining())return null;var i=t.offset,s=t.readVarint32();if(t.remaining()<s)return t.offset=i,null;try{var o=n.decode(t.slice(t.offset,t.offset+s).LE());return t.offset+=s,o}catch(u){throw t.offset+=s,u}},o.decode64=function(e){return o.decode(e,"base64")},o.decodeHex=function(e){return o.decode(e,"hex")},u.toString=function(){return n.toString()},Object.defineProperty&&(Object.defineProperty(o,"$options",{value:n.buildOpt()}),Object.defineProperty(u,"$type",{get:function(){return n}})),o}(t,this),this._fields=[],this._fieldsById={},this._fieldsByName={};for(var r=0,i=this.children.length,s;r<i;r++)if(s=this.children[r],s instanceof c)n[s.name]=s.build();else if(s instanceof a)n[s.name]=s.build();else if(s instanceof a.Field)s.build(),this._fields.push(s),this._fieldsById[s.id]=s,this._fieldsByName[s.name]=s;else if(!(s instanceof a.OneOf||s instanceof h))throw Error("Illegal reflect child of "+this.toString(!0)+": "+children[r].toString(!0));return this.clazz=n},f.encode=function(e,t,n){for(var r=null,i,s=0,o=this._fields.length,u;s<o;++s)i=this._fields[s],u=e[i.name],i.required&&null===u?null===r&&(r=i):i.encode(n?u:i.verifyValue(u),t);if(null!==r)throw e=Error("Missing at least one required field for "+this.toString(!0)+": "+r),e.encoded=t,e;return t},f.calculate=function(e){for(var t=0,n=0,r=this._fields.length,i,s;n<r;++n){i=this._fields[n],s=e[i.name];if(i.required&&null===s)throw Error("Missing at least one required field for "+this.toString(!0)+": "+i);t+=i.calculate(s)}return t},f.decode=function(e,r,i){r="number"==typeof r?r:-1;for(var s=e.offset,o=new this.clazz,u,a,f;e.offset<s+r||-1===r&&0<e.remaining();){u=e.readVarint32(),a=u&7,f=u>>3;if(a===t.WIRE_TYPES.ENDGROUP){if(f!==i)throw Error("Illegal group end indicator for "+this.toString(!0)+": "+f+" ("+(i?i+" expected":"not a group")+")");break}if(u=this._fieldsById[f])u.repeated&&!u.options.packed?o[u.name].push(u.decode(a,e)):(o[u.name]=u.decode(a,e),u.oneof&&(null!==this[u.oneof.name]&&(this[this[u.oneof.name]]=null),o[u.oneof.name]=u.name));else switch(a){case t.WIRE_TYPES.VARINT:e.readVarint32();break;case t.WIRE_TYPES.BITS32:e.offset+=4;break;case t.WIRE_TYPES.BITS64:e.offset+=8;break;case t.WIRE_TYPES.LDELIM:u=e.readVarint32(),e.offset+=u;break;case t.WIRE_TYPES.STARTGROUP:for(;n(f,e););break;default:throw Error("Illegal wire type for unknown field "+f+" in "+this.toString(!0)+"#decode: "+a)}}e=0;for(r=this._fields.length;e<r;++e)if(u=this._fields[e],null===o[u.name]){if(u.required)throw e=Error("Missing at least one required field for "+this.toString(!0)+": "+u.name),e.decoded=o,e;null!==u.defaultValue&&(o[u.name]=u.defaultValue)}return o},i.Message=a;var l=function(e,t,n,r,i,o,u,f){s.call(this,e,t,i),this.className="Message.Field",this.required="required"===n,this.repeated="repeated"===n,this.type=r,this.resolvedType=null,this.id=o,this.options=u||{},this.defaultValue=null,this.oneof=f||null,this.originalName=this.name,!this.builder.options.convertFieldsToCamelCase||this instanceof a.ExtensionField||(this.name=l._toCamelCase(this.name))};l._toCamelCase=function(e){return e.replace(/_([a-zA-Z])/g,function(e,t){return t.toUpperCase()})},f=l.prototype=Object.create(s.prototype),f.build=function(){this.defaultValue="undefined"!=typeof this.options["default"]?this.verifyValue(this.options["default"]):null},f.verifyValue=function(n,i){i=i||!1;var s=function(e,t){throw Error("Illegal value for "+this.toString(!0)+" of type "+this.type.name+": "+e+" ("+t+")")}.bind(this);if(null===n)return this.required&&s(typeof n,"required"),null;var o;if(this.repeated&&!i){t.Util.isArray(n)||(n=[n]),s=[];for(o=0;o<n.length;o++)s.push(this.verifyValue(n[o],!0));return s}!this.repeated&&t.Util.isArray(n)&&s(typeof n,"no array expected");switch(this.type){case t.TYPES.int32:case t.TYPES.sint32:case t.TYPES.sfixed32:return("number"!=typeof n||n===n&&0!==n%1)&&s(typeof n,"not an integer"),4294967295<n?n|0:n;case t.TYPES.uint32:case t.TYPES.fixed32:return("number"!=typeof n||n===n&&0!==n%1)&&s(typeof n,"not an integer"),0>n?n>>>0:n;case t.TYPES.int64:case t.TYPES.sint64:case t.TYPES.sfixed64:if(t.Long)try{return r(n,!1)}catch(u){s(typeof n,u.message)}else s(typeof n,"requires Long.js");case t.TYPES.uint64:case t.TYPES.fixed64:if(t.Long)try{return r(n,!0)}catch(a){s(typeof n,a.message)}else s(typeof n,"requires Long.js");case t.TYPES.bool:return"boolean"!=typeof n&&s(typeof n,"not a boolean"),n;case t.TYPES["float"]:case t.TYPES["double"]:return"number"!=typeof n&&s(typeof n,"not a number"),n;case t.TYPES.string:return"string"==typeof n||n&&n instanceof String||s(typeof n,"not a string"),""+n;case t.TYPES.bytes:return n&&n instanceof e?n:e.wrap(n);case t.TYPES["enum"]:var f=this.resolvedType.getChildren(c.Value);for(o=0;o<f.length;o++)if(f[o].name==n||f[o].id==n)return f[o].id;s(n,"not a valid enum value");case t.TYPES.group:case t.TYPES.message:n&&"object"==typeof n||s(typeof n,"object expected");if(n instanceof this.resolvedType.clazz)return n;if(n instanceof t.Builder.Message){s={};for(o in n)n.hasOwnProperty(o)&&(s[o]=n[o]);n=s}return new this.resolvedType.clazz(n)}throw Error("[INTERNAL] Illegal value for "+this.toString(!0)+": "+n+" (undefined type "+this.type+")")},f.encode=function(n,r){if(null===this.type||"object"!=typeof this.type)throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(null===n||this.repeated&&0==n.length)return r;try{if(this.repeated){var i;if(this.options.packed&&0<=t.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)){r.writeVarint32(this.id<<3|t.WIRE_TYPES.LDELIM),r.ensureCapacity(r.offset+=1);var s=r.offset;for(i=0;i<n.length;i++)this.encodeValue(n[i],r);var o=r.offset-s,u=e.calculateVarint32(o);if(1<u){var a=r.slice(s,r.offset),s=s+(u-1);r.offset=s,r.append(a)}r.writeVarint32(o,s-u)}else for(i=0;i<n.length;i++)r.writeVarint32(this.id<<3|this.type.wireType),this.encodeValue(n[i],r)}else r.writeVarint32(this.id<<3|this.type.wireType),this.encodeValue(n,r)}catch(f){throw Error("Illegal value for "+this.toString(!0)+": "+n+" ("+f+")")}return r},f.encodeValue=function(n,r){if(null===n)return r;switch(this.type){case t.TYPES.int32:0>n?r.writeVarint64(n):r.writeVarint32(n);break;case t.TYPES.uint32:r.writeVarint32(n);break;case t.TYPES.sint32:r.writeVarint32ZigZag(n);break;case t.TYPES.fixed32:r.writeUint32(n);break;case t.TYPES.sfixed32:r.writeInt32(n);break;case t.TYPES.int64:case t.TYPES.uint64:r.writeVarint64(n);break;case t.TYPES.sint64:r.writeVarint64ZigZag(n);break;case t.TYPES.fixed64:r.writeUint64(n);break;case t.TYPES.sfixed64:r.writeInt64(n);break;case t.TYPES.bool:"string"==typeof n?r.writeVarint32("false"===n.toLowerCase()?0:!!n):r.writeVarint32(n?1:0);break;case t.TYPES["enum"]:r.writeVarint32(n);break;case t.TYPES["float"]:r.writeFloat32(n);break;case t.TYPES["double"]:r.writeFloat64(n);break;case t.TYPES.string:r.writeVString(n);break;case t.TYPES.bytes:if(0>n.remaining())throw Error("Illegal value for "+this.toString(!0)+": "+n.remaining()+" bytes remaining");var i=n.offset;r.writeVarint32(n.remaining()),r.append(n),n.offset=i;break;case t.TYPES.message:i=(new e).LE(),this.resolvedType.encode(n,i),r.writeVarint32(i.offset),r.append(i.flip());break;case t.TYPES.group:this.resolvedType.encode(n,r),r.writeVarint32(this.id<<3|t.WIRE_TYPES.ENDGROUP);break;default:throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+n+" (unknown type)")}return r},f.calculate=function(n){n=this.verifyValue(n);if(null===this.type||"object"!=typeof this.type)throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(null===n||this.repeated&&0==n.length)return 0;var r=0;try{if(this.repeated){var i,s;if(this.options.packed&&0<=t.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)){r+=e.calculateVarint32(this.id<<3|t.WIRE_TYPES.LDELIM);for(i=s=0;i<n.length;i++)s+=this.calculateValue(n[i]);r+=e.calculateVarint32(s),r+=s}else for(i=0;i<n.length;i++)r+=e.calculateVarint32(this.id<<3|this.type.wireType),r+=this.calculateValue(n[i])}else r+=e.calculateVarint32(this.id<<3|this.type.wireType),r+=this.calculateValue(n)}catch(o){throw Error("Illegal value for "+this.toString(!0)+": "+n+" ("+o+")")}return r},f.calculateValue=function(n){if(null===n)return 0;switch(this.type){case t.TYPES.int32:return 0>n?e.calculateVarint64(n):e.calculateVarint32(n);case t.TYPES.uint32:return e.calculateVarint32(n);case t.TYPES.sint32:return e.calculateVarint32(e.zigZagEncode32(n));case t.TYPES.fixed32:case t.TYPES.sfixed32:case t.TYPES["float"]:return 4;case t.TYPES.int64:case t.TYPES.uint64:return e.calculateVarint64(n);case t.TYPES.sint64:return e.calculateVarint64(e.zigZagEncode64(n));case t.TYPES.fixed64:case t.TYPES.sfixed64:return 8;case t.TYPES.bool:return 1;case t.TYPES["enum"]:return e.calculateVarint32(n);case t.TYPES["double"]:return 8;case t.TYPES.string:return n=e.calculateUTF8Bytes(n),e.calculateVarint32(n)+n;case t.TYPES.bytes:if(0>n.remaining())throw Error("Illegal value for "+this.toString(!0)+": "+n.remaining()+" bytes remaining");return e.calculateVarint32(n.remaining())+n.remaining();case t.TYPES.message:return n=this.resolvedType.calculate(n),e.calculateVarint32(n)+n;case t.TYPES.group:return n=this.resolvedType.calculate(n),n+e.calculateVarint32(this.id<<3|t.WIRE_TYPES.ENDGROUP)}throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+n+" (unknown type)")},f.decode=function(e,n,r){if(e!=this.type.wireType&&(r||e!=t.WIRE_TYPES.LDELIM||!this.repeated))throw Error("Illegal wire type for field "+this.toString(!0)+": "+e+" ("+this.type.wireType+" expected)");if(e==t.WIRE_TYPES.LDELIM&&this.repeated&&this.options.packed&&0<=t.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)&&!r){e=n.readVarint32(),e=n.offset+e;for(r=[];n.offset<e;)r.push(this.decode(this.type.wireType,n,!0));return r}switch(this.type){case t.TYPES.int32:return n.readVarint32()|0;case t.TYPES.uint32:return n.readVarint32()>>>0;case t.TYPES.sint32:return n.readVarint32ZigZag()|0;case t.TYPES.fixed32:return n.readUint32()>>>0;case t.TYPES.sfixed32:return n.readInt32()|0;case t.TYPES.int64:return n.readVarint64();case t.TYPES.uint64:return n.readVarint64().toUnsigned();case t.TYPES.sint64:return n.readVarint64ZigZag();case t.TYPES.fixed64:return n.readUint64();case t.TYPES.sfixed64:return n.readInt64();case t.TYPES.bool:return!!n.readVarint32();case t.TYPES["enum"]:return n.readVarint32();case t.TYPES["float"]:return n.readFloat();case t.TYPES["double"]:return n.readDouble();case t.TYPES.string:return n.readVString();case t.TYPES.bytes:e=n.readVarint32();if(n.remaining()<e)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+e+" required but got only "+n.remaining());return r=n.clone(),r.limit=r.offset+e,n.offset+=e,r;case t.TYPES.message:return e=n.readVarint32(),this.resolvedType.decode(n,e);case t.TYPES.group:return this.resolvedType.decode(n,-1,this.id)}throw Error("[INTERNAL] Illegal wire type for "+this.toString(!0)+": "+e)},i.Message.Field=l,f=function(e,t,n,r,i,s,o){l.call(this,e,t,n,r,i,s,o)},f.prototype=Object.create(l.prototype),i.Message.ExtensionField=f,i.Message.OneOf=function(e,t,n){s.call(this,e,t,n),this.fields=[]};var c=function(e,t,n,r){u.call(this,e,t,n,r),this.className="Enum",this.object=null};(c.prototype=Object.create(u.prototype)).build=function(){for(var e={},t=this.getChildren(c.Value),n=0,r=t.length;n<r;++n)e[t[n].name]=t[n].id;return Object.defineProperty&&Object.defineProperty(e,"$options",{value:this.buildOpt()}),this.object=e},i.Enum=c,f=function(e,t,n,r){s.call(this,e,t,n),this.className="Enum.Value",this.id=r},f.prototype=Object.create(s.prototype),i.Enum.Value=f;var h=function(e,t,n,r){s.call(this,e,t,n),this.field=r};h.prototype=Object.create(s.prototype),i.Extension=h,f=function(e,t,n,r){u.call(this,e,t,n,r),this.className="Service",this.clazz=null},(f.prototype=Object.create(u.prototype)).build=function(e){return this.clazz&&!e?this.clazz:this.clazz=function(e,t){var n=function(t){e.Builder.Service.call(this),this.rpcImpl=t||function(e,t,n){setTimeout(n.bind(this,Error("Not implemented, see: https://github.com/dcodeIO/ProtoBuf.js/wiki/Services")),0)}},r=n.prototype=Object.create(e.Builder.Service.prototype);Object.defineProperty&&(Object.defineProperty(n,"$options",{value:t.buildOpt()}),Object.defineProperty(r,"$options",{value:n.$options}));for(var i=t.getChildren(e.Reflect.Service.RPCMethod),s=0;s<i.length;s++)(function(e){r[e.name]=function(n,r){try{n&&n instanceof e.resolvedRequestType.clazz?this.rpcImpl(e.fqn(),n,function(n,i){if(n)r(n);else{try{i=e.resolvedResponseType.clazz.decode(i)}catch(s){}i&&i instanceof e.resolvedResponseType.clazz?r(null,i):r(Error("Illegal response type received in service method "+t.name+"#"+e.name))}}):setTimeout(r.bind(this,Error("Illegal request type provided to service method "+t.name+"#"+e.name)),0)}catch(i){setTimeout(r.bind(this,i),0)}},n[e.name]=function(t,r,i){(new n(t))[e.name](r,i)},Object.defineProperty&&(Object.defineProperty(n[e.name],"$options",{value:e.buildOpt()}),Object.defineProperty(r[e.name],"$options",{value:n[e.name].$options}))})(i[s]);return n}(t,this)},i.Service=f;var p=function(e,t,n,r){s.call(this,e,t,n),this.className="Service.Method",this.options=r||{}};return(p.prototype=Object.create(s.prototype)).buildOpt=o.buildOpt,i.Service.Method=p,o=function(e,t,n,r,i,s){p.call(this,e,t,n,s),this.className="Service.RPCMethod",this.requestName=r,this.responseName=i,this.resolvedResponseType=this.resolvedRequestType=null},o.prototype=Object.create(p.prototype),i.Service.RPCMethod=o,i}(t),t.Builder=function(e,t,n){var r=function(e){this.ptr=this.ns=new n.Namespace(this,null,""),this.resolved=!1,this.result=null,this.files={},this.importRoot=null,this.options=e||{}},i=r.prototype;return i.reset=function(){this.ptr=this.ns},i.define=function(e,r){if("string"!=typeof e||!t.TYPEREF.test(e))throw Error("Illegal package: "+e);var i=e.split("."),s;for(s=0;s<i.length;s++)if(!t.NAME.test(i[s]))throw Error("Illegal package: "+i[s]);for(s=0;s<i.length;s++)null===this.ptr.getChild(i[s])&&this.ptr.addChild(new n.Namespace(this,this.ptr,i[s],r)),this.ptr=this.ptr.getChild(i[s]);return this},r.isValidMessage=function(n){if("string"!=typeof n.name||!t.NAME.test(n.name)||"undefined"!=typeof n.values||"undefined"!=typeof n.rpc)return!1;var i;if("undefined"!=typeof n.fields){if(!e.Util.isArray(n.fields))return!1;var s=[],o;for(i=0;i<n.fields.length;i++){if(!r.isValidMessageField(n.fields[i]))return!1;o=parseInt(n.fields[i].id,10);if(0<=s.indexOf(o))return!1;s.push(o)}}if("undefined"!=typeof n.enums){if(!e.Util.isArray(n.enums))return!1;for(i=0;i<n.enums.length;i++)if(!r.isValidEnum(n.enums[i]))return!1}if("undefined"!=typeof n.messages){if(!e.Util.isArray(n.messages))return!1;for(i=0;i<n.messages.length;i++)if(!r.isValidMessage(n.messages[i])&&!r.isValidExtend(n.messages[i]))return!1}return"undefined"==typeof n.extensions||e.Util.isArray(n.extensions)&&2===n.extensions.length&&"number"==typeof n.extensions[0]&&"number"==typeof n.extensions[1]?!0:!1},r.isValidMessageField=function(e){if("string"!=typeof e.rule||"string"!=typeof e.name||"string"!=typeof e.type||"undefined"==typeof e.id||!(t.RULE.test(e.rule)&&t.NAME.test(e.name)&&t.TYPEREF.test(e.type)&&t.ID.test(""+e.id)))return!1;if("undefined"!=typeof e.options){if("object"!=typeof e.options)return!1;for(var n=Object.keys(e.options),r=0,i;r<n.length;r++)if("string"!=typeof (i=n[r])||"string"!=typeof e.options[i]&&"number"!=typeof e.options[i]&&"boolean"!=typeof e.options[i])return!1}return!0},r.isValidEnum=function(n){if("string"!=typeof n.name||!t.NAME.test(n.name)||"undefined"==typeof n.values||!e.Util.isArray(n.values)||0==n.values.length)return!1;for(var r=0;r<n.values.length;r++)if("object"!=typeof n.values[r]||"string"!=typeof n.values[r].name||"undefined"==typeof n.values[r].id||!t.NAME.test(n.values[r].name)||!t.NEGID.test(""+n.values[r].id))return!1;return!0},i.create=function(t){if(!t)return this;e.Util.isArray(t)||(t=[t]);if(0==t.length)return this;var i=[];for(i.push(t);0<i.length;){t=i.pop();if(!e.Util.isArray(t))throw Error("Not a valid namespace: "+JSON.stringify(t));for(;0<t.length;){var s=t.shift();if(r.isValidMessage(s)){var o=new n.Message(this,this.ptr,s.name,s.options,s.isGroup),u={};if(s.oneofs)for(var a=Object.keys(s.oneofs),f=0,l=a.length;f<l;++f)o.addChild(u[a[f]]=new n.Message.OneOf(this,o,a[f]));if(s.fields&&0<s.fields.length)for(f=0,l=s.fields.length;f<l;++f){a=s.fields[f];if(null!==o.getChild(a.id))throw Error("Duplicate field id in message "+o.name+": "+a.id);if(a.options)for(var c=Object.keys(a.options),h=0,p=c.length;h<p;++h){if("string"!=typeof c[h])throw Error("Illegal field option name in message "+o.name+"#"+a.name+": "+c[h]);if("string"!=typeof a.options[c[h]]&&"number"!=typeof a.options[c[h]]&&"boolean"!=typeof a.options[c[h]])throw Error("Illegal field option value in message "+o.name+"#"+a.name+"#"+c[h]+": "+a.options[c[h]])}c=null;if("string"==typeof a.oneof&&(c=u[a.oneof],"undefined"==typeof c))throw Error("Illegal oneof in message "+o.name+"#"+a.name+": "+a.oneof);a=new n.Message.Field(this,o,a.rule,a.type,a.name,a.id,a.options,c),c&&c.fields.push(a),o.addChild(a)}u=[];if("undefined"!=typeof s.enums&&0<s.enums.length)for(f=0;f<s.enums.length;f++)u.push(s.enums[f]);if(s.messages&&0<s.messages.length)for(f=0;f<s.messages.length;f++)u.push(s.messages[f]);s.extensions&&(o.extensions=s.extensions,o.extensions[0]<e.ID_MIN&&(o.extensions[0]=e.ID_MIN),o.extensions[1]>e.ID_MAX&&(o.extensions[1]=e.ID_MAX)),this.ptr.addChild(o),0<u.length&&(i.push(t),t=u,this.ptr=o)}else if(r.isValidEnum(s)){o=new n.Enum(this,this.ptr,s.name,s.options);for(f=0;f<s.values.length;f++)o.addChild(new n.Enum.Value(this,o,s.values[f].name,s.values[f].id));this.ptr.addChild(o)}else if(r.isValidService(s)){o=new n.Service(this,this.ptr,s.name,s.options);for(f in s.rpc)s.rpc.hasOwnProperty(f)&&o.addChild(new n.Service.RPCMethod(this,o,f,s.rpc[f].request,s.rpc[f].response,s.rpc[f].options));this.ptr.addChild(o)}else{if(!r.isValidExtend(s))throw Error("Not a valid definition: "+JSON.stringify(s));if(o=this.ptr.resolve(s.ref))for(f=0;f<s.fields.length;f++){if(null!==o.getChild(s.fields[f].id))throw Error("Duplicate extended field id in message "+o.name+": "+s.fields[f].id);if(s.fields[f].id<o.extensions[0]||s.fields[f].id>o.extensions[1])throw Error("Illegal extended field id in message "+o.name+": "+s.fields[f].id+" ("+o.extensions.join(" to ")+" expected)");u=s.fields[f].name,this.options.convertFieldsToCamelCase&&(u=n.Message.Field._toCamelCase(s.fields[f].name)),a=new n.Message.ExtensionField(this,o,s.fields[f].rule,s.fields[f].type,this.ptr.fqn()+"."+u,s.fields[f].id,s.fields[f].options),u=new n.Extension(this,this.ptr,s.fields[f].name,a),a.extension=u,this.ptr.addChild(u),o.addChild(a)}else if(!/\.?google\.protobuf\./.test(s.ref))throw Error("Extended message "+s.ref+" is not defined")}}this.ptr=this.ptr.parent}return this.resolved=!1,this.result=null,this},i["import"]=function(t,n){if("string"==typeof n){e.Util.IS_NODE&&(n=require("path").resolve(n));if(!0===this.files[n])return this.reset(),this;this.files[n]=!0}if(t.imports&&0<t.imports.length){var r,i="/",s=!1;if("object"==typeof n){if(this.importRoot=n.root,s=!0,r=this.importRoot,n=n.file,0<=r.indexOf("\\")||0<=n.indexOf("\\"))i="\\"}else"string"==typeof n?this.importRoot?r=this.importRoot:0<=n.indexOf("/")?(r=n.replace(/\/[^\/]*$/,""),""===r&&(r="/")):0<=n.indexOf("\\")?(r=n.replace(/\\[^\\]*$/,""),i="\\"):r=".":r=null;for(var o=0;o<t.imports.length;o++)if("string"==typeof t.imports[o]){if(!r)throw Error("Cannot determine import root: File name is unknown");var u=t.imports[o];if(!/^google\/protobuf\//.test(u)&&(u=r+i+u,!0!==this.files[u])){/\.proto$/i.test(u)&&!e.DotProto&&(u=u.replace(/\.proto$/,".json"));var a=e.Util.fetch(u);if(null===a)throw Error("Failed to import '"+u+"' in '"+n+"': File not found");/\.json$/i.test(u)?this["import"](JSON.parse(a+""),u):this["import"]((new e.DotProto.Parser(a+"")).parse(),u)}}else n?/\.(\w+)$/.test(n)?this["import"](t.imports[o],n.replace(/^(.+)\.(\w+)$/,function(e,t,n){return t+"_import"+o+"."+n})):this["import"](t.imports[o],n+"_import"+o):this["import"](t.imports[o]);s&&(this.importRoot=null)}return t.messages&&(t["package"]&&this.define(t["package"],t.options),this.create(t.messages),this.reset()),t.enums&&(t["package"]&&this.define(t["package"],t.options),this.create(t.enums),this.reset()),t.services&&(t["package"]&&this.define(t["package"],t.options),this.create(t.services),this.reset()),t["extends"]&&(t["package"]&&this.define(t["package"],t.options),this.create(t["extends"]),this.reset()),this},r.isValidService=function(e){return"string"==typeof e.name&&!!t.NAME.test(e.name)&&"object"==typeof e.rpc},r.isValidExtend=function(n){if("string"!=typeof n.ref||!t.TYPEREF.test(n.ref))return!1;var i;if("undefined"!=typeof n.fields){if(!e.Util.isArray(n.fields))return!1;var s=[],o;for(i=0;i<n.fields.length;i++){if(!r.isValidMessageField(n.fields[i]))return!1;o=parseInt(n.id,10);if(0<=s.indexOf(o))return!1;s.push(o)}}return!0},i.resolveAll=function(){var r;if(null!=this.ptr&&"object"!=typeof this.ptr.type){if(this.ptr instanceof n.Namespace){r=this.ptr.children;for(var i=0,s=r.length;i<s;++i)this.ptr=r[i],this.resolveAll()}else if(this.ptr instanceof n.Message.Field)if(t.TYPE.test(this.ptr.type))this.ptr.type=e.TYPES[this.ptr.type];else{if(!t.TYPEREF.test(this.ptr.type))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);r=(this.ptr instanceof n.Message.ExtensionField?this.ptr.extension.parent:this.ptr.parent).resolve(this.ptr.type,!0);if(!r)throw Error("Unresolvable type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);this.ptr.resolvedType=r;if(r instanceof n.Enum)this.ptr.type=e.TYPES["enum"];else{if(!(r instanceof n.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);this.ptr.type=r.isGroup?e.TYPES.group:e.TYPES.message}}else if(!(this.ptr instanceof e.Reflect.Enum.Value))if(this.ptr instanceof e.Reflect.Service.Method){if(!(this.ptr instanceof e.Reflect.Service.RPCMethod))throw Error("Illegal service type in "+this.ptr.toString(!0));r=this.ptr.parent.resolve(this.ptr.requestName);if(!(r&&r instanceof e.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.requestName);this.ptr.resolvedRequestType=r,r=this.ptr.parent.resolve(this.ptr.responseName);if(!(r&&r instanceof e.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.responseName);this.ptr.resolvedResponseType=r}else if(!(this.ptr instanceof e.Reflect.Message.OneOf||this.ptr instanceof e.Reflect.Extension))throw Error("Illegal object in namespace: "+typeof this.ptr+":"+this.ptr);this.reset()}},i.build=function(e){this.reset(),this.resolved||(this.resolveAll(),this.resolved=!0,this.result=null),null==this.result&&(this.result=this.ns.build());if(e){e=e.split(".");for(var t=this.result,n=0;n<e.length;n++){if(!t[e[n]]){t=null;break}t=t[e[n]]}return t}return this.result},i.lookup=function(e){return e?this.ns.resolve(e):this.ns},i.toString=function(){return"Builder"},r.Message=function(){},r.Service=function(){},r}(t,t.Lang,t.Reflect),t.loadProto=function(e,n,r){if("string"==typeof n||n&&"string"==typeof n.file&&"string"==typeof n.root)r=n,n=void 0;return t.loadJson((new t.DotProto.Parser(e)).parse(),n,r)},t.protoFromString=t.loadProto,t.loadProtoFile=function(e,n,r){n&&"object"==typeof n?(r=n,n=null):n&&"function"==typeof n||(n=null);if(n)return t.Util.fetch("string"==typeof e?e:e.root+"/"+e.file,function(i){if(null===i)n(Error("Failed to fetch file"));else try{n(null,t.loadProto(i,r,e))}catch(s){n(s)}});var i=t.Util.fetch("object"==typeof e?e.root+"/"+e.file:e);return null===i?null:t.loadProto(i,r,e)},t.protoFromFile=t.loadProtoFile,t.newBuilder=function(e){return e=e||{},"undefined"==typeof e.convertFieldsToCamelCase&&(e.convertFieldsToCamelCase=t.convertFieldsToCamelCase),"undefined"==typeof e.populateAccessors&&(e.populateAccessors=t.populateAccessors),new t.Builder(e)},t.loadJson=function(e,n,r){if("string"==typeof n||n&&"string"==typeof n.file&&"string"==typeof n.root)r=n,n=null;return n&&"object"==typeof n||(n=t.newBuilder()),"string"==typeof e&&(e=JSON.parse(e)),n["import"](e,r),n.resolveAll(),n.build(),n},t.loadJsonFile=function(e,n,r){n&&"object"==typeof n?(r=n,n=null):n&&"function"==typeof n||(n=null);if(n)return t.Util.fetch("string"==typeof e?e:e.root+"/"+e.file,function(i){if(null===i)n(Error("Failed to fetch file"));else try{n(null,t.loadJson(JSON.parse(i),r,e))}catch(s){n(s)}});var i=t.Util.fetch("object"==typeof e?e.root+"/"+e.file:e);return null===i?null:t.loadJson(JSON.parse(i),r,e)},t}"function"==typeof require&&"object"==typeof module&&module&&module.id&&"object"==typeof exports&&exports?module.exports=t(require("bytebuffer")):"function"==typeof webswingRequirejs.define&&webswingRequirejs.define.amd?webswingRequirejs.define(["ByteBuffer"],t):(e.dcodeIO=e.dcodeIO||{}).ProtoBuf=t(e.dcodeIO.ByteBuffer)})(this);