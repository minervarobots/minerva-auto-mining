webswingRequirejs.define(["jquery","text!templates/login.html"],function(t,n){return function(){function o(){return{content:n,events:{loginBtn_click:function(e){i.start()},passwordInput_keyup:function(e){e.keyCode==13&&i.start()},nameInput_keyup:function(e){e.keyCode==13&&i.start()}}}}function u(e,n){t.ajax({xhrFields:{withCredentials:!0},type:"POST",url:i.cfg.connectionUrl+"login"+(i.cfg.anonym?"?mode=anonym":""),data:a()?i.cfg.rootElement.find('form[data-id="loginForm"]').serialize():"",success:function(t){if(a()){var n=i.cfg.rootElement.find('*[data-id="loginErrorMsg"]');n.html("")}s=t,e!=null&&e()},error:function(e){if(n!=null)n();else if(!a())i.showDialog(i.loginDialog);else{var t=i.cfg.rootElement.find('*[data-id="loginErrorMsg"]');t.html('<div class="alert alert-danger">'+e.responseText+"</div>")}}})}function a(){return i.currentDialog()===i.loginDialog}function f(){function e(e){s=null,i.showDialog(i.loginDialog)}t.ajax({xhrFields:{withCredentials:!0},type:"GET",url:i.cfg.connectionUrl+"logout",data:"",success:e,error:e})}function l(){return s}var r=this,i;r.injects=i={cfg:"webswing.config",start:"webswing.start",loginDialog:o(),currentDialog:"dialog.current",showDialog:"dialog.show"},r.provides={login:u,logout:f,user:l};var s}});