webswingRequirejs.define(["jquery","text!templates/touch.html","text!templates/touch.css","webswing-util","hammer"],function(t,n,r,i,s){var o=t("<style></style>",{type:"text/css"});return o.text(r),t("head").prepend(o),function(){function c(){var e=o.getCanvas();i.preventGhosts(o.cfg.rootElement),u=new s(e,{touchAction:"manipulation"}),u.get("tap").set({threshold:4}),u.on("tap",function(t){if(t.pointerType==="touch"){var n=p(e,t,1);o.send(n),d(),e.focus()}}),u.on("press",function(t){if(t.pointerType==="touch"){var n=p(e,t,3);o.send(n)}})}function h(e){e.value=" ",e.focus(),e.select()}function p(e,t,n){function o(e){return{mouse:{x:i,y:s,type:e,button:n}}}var r=e.getBoundingClientRect(),i=Math.round(t.center.x-r.left),s=Math.round(t.center.y-r.top);return{events:[o("mousedown"),o("mouseup")]}}function d(){a!=null&&m(),o.cfg.rootElement.append(n),a=o.cfg.rootElement.find('div[data-id="touchBar"]'),a.find('button[data-id="kbdBtn"]').on("click",function(e){o.cfg.virtualKB=!0,h(o.getInput()),m(),t(o.getInput()).on("input compositionstart compositionupdate compositionend",v),t(o.getInput()).on("blur",function(e){o.cfg.virtualKB=!1,t(o.getInput()).off("compositionstart compositionupdate compositionend")})}),a.show("fast")}function v(e){e.type==="compositionstart"&&(f=e.originalEvent.data,l=!0);if(e.type==="compositionupdate"||e.type==="compositionend"){var t=e.originalEvent.data;t.indexOf(f)==0?g(t.substring(f.length)):(y(f.length),g(t)),f=t}e.type==="compositionend"&&(f="",setTimeout(function(){e.currentTarget.value="",l=!1},0));if(e.type==="input"&&!l){var t=e.originalEvent.target.value;g(t),e.currentTarget.value=""}}function m(){a!=null&&(a.hide("fast"),a.remove(),a=null)}function g(e){for(var t=0,n=e.length;t<n;t++){var r=0;r=e.charCodeAt(t),o.send({events:[b("keydown",r),b("keypress",r),b("keyup",r)]})}}function y(e){var t=[];for(var n=0;n<e;n++)t.push(b("keydown",8,8)),t.push(b("keyup",8,8));o.send({events:t})}function b(e,t,n){return{key:{type:e,character:t,keycode:n!=null?n:0,alt:!1,ctrl:!1,shift:!1,meta:!1}}}function w(){m()}var r=this,o;r.injects=o={cfg:"webswing.config",send:"socket.send",getInput:"canvas.getInput",getCanvas:"canvas.get"},r.provides={register:c,dispose:w},r.ready=function(){};var u,a,f="",l=!1}});